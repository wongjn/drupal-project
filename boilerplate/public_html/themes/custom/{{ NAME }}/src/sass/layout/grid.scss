/**
 * @file
 * Layout items in a grid.
 */

@import '../system';

// Spacing between items
$gutter: 40px;
$half-gutter: $gutter / 2;

// Supported grid widths, key as BEM variant name
$columns: (
  // thirds: 3,
  // quarters: 4,
  // sixths: 6,
);

@mixin variants($gutter: $gutter, $container-width: $SITE-WIDTH-PX) {
  @at-root {
    @each $name, $column in $columns {
      #{if("#{&}" == '.l-grid', '', &)}.l-grid--#{$name} {
        // Exact width
        $width: column-width($column, $gutter, $container-width);
        // Min-width for grid to be at the desired column count at full site width
        $min-width: (column-width($column + 1, $gutter, $container-width) + 1px);

        --column-min-width: #{$min-width};
        --column-width: #{$width};

        > .l-grid__item {
          flex-basis: $width;
        }

        // Fix overflowing grid areas
        &.l-grid--flexy {
          @media (max-width: #{$min-width + ($gutter * 2)}) {
            grid-template-columns: repeat(auto-fill, minmax(0, var(--column-width)));
          }
        }
      }
    }
  }
}

.l-grid {
  @include viewport-scale(--gutter-x, $half-gutter, 20px);
  @include viewport-scale(--gutter-y, $half-gutter, 20px);
  @include variants;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  margin: ($half-gutter * -1);
  margin: calc(var(--gutter-y) * -1) calc(var(--gutter-x) * -1);

  @supports (display: grid) {
    display: grid;
    margin: 0;
    grid-template-columns: repeat(auto-fill, minmax(0, var(--column-width)));
    grid-gap: calc(var(--gutter-y) * 2) calc(var(--gutter-x) * 2);

    @include edge {
      grid-gap: $gutter;
    }
  }

  &__item {
    flex-shrink: 0;
    margin: $half-gutter;
    margin: var(--gutter-y) var(--gutter-x);
    max-width: calc(100% - (var(--gutter-x) * 2));

    @supports (display: grid) {
      margin: 0;
      max-width: 100%;
    }
  }

  // Stretches grids to fill container width instead of static widths.
  &--flexy {
    grid-template-columns: repeat(auto-fill, minmax(var(--column-min-width), 1fr));
  }
}
